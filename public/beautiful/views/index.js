$(document).ready(function(){!function(a){function e(a){String.prototype.filterUrl=function(){return this.replace(/#\//,"")},this.config=a,this.init=function(){var a=this;a._init(),window.addEventListener("hashchange",function(){a._init()})}}e.prototype={_init:function(){for(var a=location.hash.filterUrl().split("/"),e=document.getElementsByClassName("page"),t=0;t<e.length;t++)e[t].style.display="none";document.getElementById(a[0]||"home").style.display="block"}};var t=[{url:"",templateId:"home"},{url:"join",templateId:"join"},{url:"search",templateId:"search"},{url:"detail",templateId:"detail"}];console.log(t),new e(t).init(),a&&a()}(function(){console.log("dasfasdf");var u=this;function d(r){$(".players-wrapper").html("");for(var a=0;a<r.length;a++){for(var e=r[a].type=0,t="./resource/images/player_start_c.png",s=r[a],i=0;i<u.playerStaredList.length;i++){u.playerStaredList[i]==s.playerId&&(e=r[a].type=1,t="./resource/images/player_start_o.png")}$(".players-wrapper").append('                <div class="player-wrapper hover-btn" data-playerid="'+s.playerId+'" data-type="'+e+'">                    <div class="player-avatar-wrapper">                        <img src="'+s.picUrl+'" class="player-avatar">                    </div>                    <div class="player-info">                        <img class="player-start hover-btn" src="'+t+'"                            data-playerid="'+s.playerId+'" data-type="'+e+'">                        <span class="player-votes">'+s.like+'</span>                        <span class="player-name">'+s.name+'</span>                        <span class="player-company">'+s.company+'</span>                        <span class="player-post">'+s.job+"</span>                        </div>                        </div>")}$(".player-wrapper").unbind("click"),$(".player-wrapper").click(function(a){for(var e,t=0;t<r.length;t++){r[t];a.currentTarget.dataset.playerid==r[t].playerId&&(e=r[t])}e.playerId&&(y(e),utils.goTo("detail"))}),$(".player-start").unbind("click"),$(".player-start").click(function(a){if(a.stopPropagation(),a.target==this){for(var e,t=0;t<r.length;t++){r[t];a.currentTarget.dataset.playerid==r[t].playerId&&(e=r[t])}e.playerId&&l(e)}})}function a(){utils.showLoading(),getPlayerList({sp:this.playerListSp,num:6},function(a){u.playerStaredList=a.myLike,0<a.players.length?(u.playerListSp=a.sp,u.playerList.push(a.players),d(a.players),e()):0==a.players.length&&(e(),0<u.playPage&&u.playPage--)})}function e(){0==u.playPage?$(".pagination-previous").hide():$(".pagination-previous").show(),u.playerList[u.playPage].length<6?$(".pagination-next").hide():$(".pagination-next").show()}function t(e){getMessageList({sp:u.mesListSp,num:20},function(a){0<a.items.length&&(u.mesListSp=a.sp,function(a,e){a&&$(".message-wrapper").html("");for(var t=0;t<e.length;t++){var r=e[t];$(".message-wrapper").append('                    <div class="message">'+r.content+"</div>                ")}}(e,a.items))})}this.playPage=0,this.playerList=[],this.playerStaredList=[],this.playerListSp=0,a(),$(".pagination-previous").click(function(){u.playPage--,e(),d(u.playerList[u.playPage])}),$(".pagination-next").click(function(){u.playPage++,u.playPage<u.playerList.length?(d(u.playerList[u.playPage]),e()):a()}),this.mesListSp=0,t();var r=0,s=0,i=$(".message-wrapper").height();function n(){u.searchRequestLock||($(".search-tips").html("加载中..."),u.searchRequestLock=!0,getPlayerSearchList({keyword:u.searchName,sp:u.searchSp,num:10},function(a){utils.hideLoading(),u.searchRequestLock=!1,0<a.items.length?(u.searchSp=a.sp,a.items.length<10?$(".search-tips").html("没有更多了"):$(".search-tips").html("加载中..."),function(s){for(var a=0;a<s.length;a++){var e=s[a];$(".search-list-wrapper").append('                        <div class="search-item" data-playerid="'+e.playerId+'">                        <img src="'+e.picUrl+'" class="search-player-avatar">                        <span class="search-player-name">'+e.name+'</span>                        <span class="search-player-star">                        <span class="search-player-star-num">'+e.like+"</span>人喜欢</span>                    </div>")}$(".search-item").unbind("click"),$(".search-item").click(function(a){for(var e,t=0;t<s.length;t++)if(s[t],a.currentTarget.dataset.playerid==s[t].playerId)for(var r=(e=s[t]).type=0;r<u.playerStaredList.length;r++)u.playerStaredList[r].playerId==e.playerId&&(e.type=1);e&&(y(e),utils.goTo("detail"))})}(a.items)):0==u.searchSp?$(".search-tips").html("没有搜索到诶～"):$(".search-tips").html("没有更多了")}))}function y(a,e){$(".detail-avatar").attr("src",a.picUrl),$(".detail-info-star-btn").attr("src","0"==a.type?"./resource/images/player_start_c.png":"./resource/images/player_start_o.png"),$(".detail-name").html(a.name),$(".detail-company").html(a.company),$(".detail-job").html(a.job),$(".detail-contact").html(a.contact),$(".detail-info-star-num").html(a.like),$(".detail-contact-href").attr("href","tel:"+a.contact),$(".detail-info-star-btn").unbind("click"),e||$(".detail-info-star-btn").click(function(){l(a)})}function l(o,c){var h=o.playerId;"0"==(c=o.type)?utils.showLoading("点赞中..."):utils.showLoading("取消点赞..."),dotStar({playerId:h,type:"1"==c?0:1},function(a){if(200==a.status){for(var e,t,r=0;r<u.playerList.length;r++)for(var s=u.playerList[r],i=0;i<s.length;i++)s[i].playerId==h&&(t=i,e=r);var n=o.like,l=0;if("0"==c){var p=!1;for(i=0;i<u.playerStaredList.length;i++)u.playerStaredList[i]==h&&(p=!0);p||u.playerStaredList.push(h),n++,l=1}else{for(i=0;i<u.playerStaredList.length;i++)u.playerStaredList[i]==h&&u.playerStaredList.splice(i,1);n--,l=0}u.playerList[e]&&u.playerList[e][t]?(u.playerList[e][t].like=n,u.playerList[e][t].type=l,y(u.playerList[e][t]),d(u.playerList[u.playPage])):(o.like=n,o.type=l,y(o))}else 10002==a.status?($(".star-tips-wrapper").fadeIn(200),setTimeout(function(){$(".star-tips-wrapper").fadeOut(200)},2600)):utils.showError(a.message)})}$(".message-wrapper").scroll(function(){r=$(this)[0].scrollHeight,s=$(this)[0].scrollTop,r-20<=s+i&&t()}),$(".send-btn").click(function(){var a=$(".send-input").val();a&&(utils.showLoading("发表中..."),sendMessage({content:a},function(){u.mesListSp=0,$(".send-input").val(""),t(!0)}))}),$("#home .search-btn").click(function(){u.searchSp=0,u.searchName=$(".search-input").val(),$(".search-input").val(u.searchName),u.searchName?(utils.showLoading("搜索中..."),$(".search-list-wrapper").html(""),utils.goTo("search"),u.searchCanLoadingMore=!0,n()):utils.showError("请输入名字")}),$(".join-btn").click(function(){utils.goTo("join")}),this.searchName,this.searchSp=0,this.searchRequestLock=!1,this.searchCanLoadingMore=!1,$(window).scroll(function(){$(document).scrollTop(),$(document).scrollTop()>=$(document).height()-$(window).height()-30&&u.searchCanLoadingMore&&(console.log("加载更多..."),n(u.searchName))}),window.addEventListener("hashchange",function(){window.location.hash||(u.searchCanLoadingMore=!1)}),$(".search-input-cancel").click(function(){$(".search-input").val(""),$(".search-input").focus()}),$(".search-cancel-btn").click(function(){$(".search-input").val(""),$(".search-list-wrapper").html(""),utils.back()}),$("#search .search-btn").click(function(){u.searchSp=0,u.searchName=$(".page3 .search-input").val(),u.searchName?(u.searchRequestLock=!1,$(".search-list-wrapper").html(""),n()):utils.showError("请输入名字")}),$(".page3 .search-input").focus(function(){u.searchRequestLock=!0,$(".search-list-wrapper").html(""),$(".search-input-cancel").show(),$(".search-tips").html("搜索最美同事，为他/她点赞")}),$(".page3 .search-input").blur(function(){});var p={};function o(a){for(var e,t=0,r=$.trim(a.val()),s=0;s<r.length;s++)1==(e=r.charAt(s),!/[u00-uff]/.test(e))?t+=2:t+=1;return t=Math.ceil(t)}(new FileRead).changeFile("fileUpload",800,function(a){utils.showLoading(),setTimeout(function(){$(".join-cover-wrapper").show(),utils.hideLoading();try{p=new window.PGClip({wrap:"cutBox",image:"cutImg",src:a.src})}catch(a){}},1e3)}),$(".join-choose-btn").click(function(){p.draw(600,function(a){$(".addPic-wrapper").html('                    <img src="'+a+'" alt="" class="added-pic">                '),$(".join-cover-wrapper").hide()})}),$(".add-done-btn").click(function(){var a=$(".join-input-name").val(),e=$(".join-input-company").val(),t=$(".join-input-job").val(),r=$(".join-input-contact").val(),s=$(".added-pic").attr("src");if(a)if(16<o($(".join-input-name")))utils.showError("姓名长度过长");else if(e)if(16<o($(".join-input-company")))utils.showError("公司名长度过长");else if(t)if(16<o($(".join-input-job")))utils.showError("职位长度过长");else if(r)if(/^\d{11}$/.test(r))if(s){var i=function(a){var e;e=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):unescape(a.split(",")[1]);for(var t=a.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(e.length),s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return new Blob([r],{type:t})}(s);utils.showLoading("报名中..."),playerJoin({name:a,company:e,job:t,contact:r,pic:i},function(e){utils.hideLoading(),200==e.status?($(".tips-wrapper").fadeIn(200),setTimeout(function(){var a;$(".tips-wrapper").fadeOut(200),u.ownPlayer=e.data,a=u.ownPlayer,$(".own-wrapper").html(""),$(".own-wrapper").append('                <div class="own-player-wrapper hover-btn" data-playerid="'+a.playerId+'">                    <div class="player-avatar-wrapper">                        <img src="'+a.picUrl+'" class="player-avatar">                    </div>                    <div class="player-info">                        <span class="player-votes">'+a.like+'</span>                        <span class="player-name">'+a.name+'</span>                        <span class="player-company">'+a.company+'</span>                        <span class="player-post">'+a.job+"</span>                    </div>                </div>"),$(".own-player-wrapper").unbind("click"),$(".own-player-wrapper").click(function(a){u.ownPlayer.playerId&&(y(u.ownPlayer,!0),utils.goTo("detail"))}),utils.back()},1500)):10001==e.status&&utils.showError("你已经报过名了")})}else utils.showError("请输入上传照片");else utils.showError("请输入正确的联系方式");else utils.showError("请输入联系方式");else utils.showError("请输入职位");else utils.showError("请输入公司名");else utils.showError("请输入姓名")}),this.ownPlayer={},$(".hover-btn").on("touchstart",function(){$(this).css({opacity:.7})}),$(".hover-btn").on("touchend",function(){$(this).css({opacity:1})})})});