!function(){var s={},e=function(){"undefined"!=typeof FileReader||console.error("您的浏览器不支持FileReader！")},h=e.prototype;h.changeFile=function(e,t,a){h.size=t,$("."+e).change(function(e){!function(e,o){var t=e.files;if(t.length<1)return;$("#loading").addClass("active"),$.each(t,function(e,a){if(20971520<a.size)o&&o(0);else{var i=a.type.split("/");switch(i[0]){case"image":n=a,r=function(t){t.size=a.size,t.fileType=i[0],l(t.src,function(e){t.src=e,o&&o(t)})},(t=new FileReader).readAsDataURL(n),t.onload=function(e){s.fileName=n.name,s.size=n.size,s.src=this.result;var t=new Date(n.lastModifiedDate);s.uploadTime=t.getFullYear()+" "+(parseInt(t.getMonth())+1)+" "+t.getDate(),"function"==typeof r&&r(s)};break;default:o&&o({fileType:i[0]})}}var n,r,t})}(this,function(e){a&&a(e)})})};var l=function(e,s){var l=document.createElement("canvas");l.style.width="100%";var c=l.getContext("2d"),d=new Image;d.src=e,d.onload=function(){var e,t,a=(e=d,EXIF.getData(e,function(){t=EXIF.getTag(this,"Orientation")}),t),i=d.width,n=d.height,r=h.size||i;console.log(r,i,n),i<r&&(r=i);var o=n*(r/i);6==a?(l.width=o,l.height=r,c.save(),c.translate(o,0),c.rotate(90*Math.PI/180),c.drawImage(d,0,0,i,n,0,0,r,o),c.restore()):8==a?(l.width=o,l.height=r,c.save(),c.translate(o,0),c.rotate(90*Math.PI/180),c.drawImage(d,0,0,i,n,0,0,r,o),c.restore()):3==a?(l.width=r,l.height=o,c.save(),c.translate(r,o),c.rotate(180*Math.PI/180),c.drawImage(d,0,0,i,n,0,0,r,o),c.restore()):(l.width=r,l.height=o,c.drawImage(d,0,0,i,n,0,0,r,o)),s&&s(l.toDataURL())}};window.FileRead=e}();