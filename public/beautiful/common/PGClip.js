!function(t){var a=function(t){i(t,this)},i=function(t,a){t&&!(!t instanceof Object)&&t.wrap&&t.image&&document.querySelector("#"+t.wrap)&&document.querySelector("#"+t.image)?(a.clipWrap=document.getElementById(t.wrap),a.originImage=document.getElementById(t.image),a.src=t.src,a.clipWrapTop=0,a.scale=1,a.dragable=!1,a.transform={},a.cutParmas={imgUrl:"",cutBoxWidth:0,cutBoxHeight:0,imgHeight:0,imgWidth:0,imgCutWidth:0,imgCutHeight:0,cutScale:0,x:0,y:0},e(a)):console.warn("参数不合法，请传入{wrap:裁剪框ID, image:裁剪图片ID}")},e=function(t){t.clipWrap.style.position="relative",t.originImage.style.left=0,t.originImage.style.top=0,r(t)},r=function(n){var m=n.originImage,t=n.clipWrap,o=t.clientHeight/t.clientWidth,s=t.clientHeight,c=t.clientWidth,g=new Image;g.src=n.src,g.onload=function(){m.src=g.src;var t=g.width,a=g.height,i=0,e=0;n.cutParmas.imgUrl=g.src,n.cutParmas.cutBoxWidth=c,n.cutParmas.cutBoxHeight=s,n.cutParmas.imgHeight=a,n.cutParmas.imgWidth=t,n.cutParmas.cutScale=c/s;var r=t/a;a/t<o?(n.scale=s/a,window.allScale=n.scale,n.cutParmas.imgCutHeight=s,n.cutParmas.imgCutWidth=s*r,m.height=e=s,m.width=parseInt(i=s*t/a)):(n.scale=c/t,window.allScale=n.scale,n.cutParmas.imgCutHeight=c,n.cutParmas.imgCutWidth=c*r,m.width=i=c,m.height=parseInt(e=c*a/t)),window.Hammer?(h(n),n.maxImagePosition={maxX:0,minX:0+c-i,maxY:0,minY:s-e},n.transform.translate={x:0,y:0},0<n.maxImagePosition.minY&&(n.dragable=!1),0<n.maxImagePosition.minX&&(n.dragable=!1)):console.warn("缺少Hammer.js")}},n=a.prototype;n.getParam=function(){return{srcX:Math.floor((0-this.transform.translate.x)/this.scale),srcY:Math.floor((this.clipWrapTop-this.transform.translate.y)/this.scale),srcW:Math.floor(this.clipWrap.clientWidth/this.scale),srcH:Math.floor(this.clipWrap.clientHeight/this.scale)}},n.stopDrag=function(){this.mc.off("panstart panmove",this.onPan)},n.startDrag=function(){this.mc.on("panstart panmove",this.onPan)};var h=function(e){e.dragable=!0,e.transform={};var t=window[Hammer.prefixed(window,"requestAnimationFrame")]||function(t){window.setTimeout(t,1e3/60)},i=e.originImage,r=0,n=0,m=!1,a=new Hammer.Manager(e.clipWrap);function o(){var t=["scale("+e.transform.scale+", "+e.transform.scale+")","rotate3d("+e.transform.rx+","+e.transform.ry+","+e.transform.rz+","+e.transform.angle+"deg)"],a="translate3d("+e.transform.translate.x+"px, "+e.transform.translate.y+"px, 0)";t=t.join(" "),i.style.webkitTransform=a,i.style.mozTransform=a,i.style.transform=a,m=!1}function s(){m||(t(o),m=!0)}function c(t){if(0!=e.dragable){"panstart"==t.type&&e.transform.translate&&(r=e.transform.translate.x,n=e.transform.translate.y);var a=Math.max(r+t.deltaX,e.maxImagePosition.minX),i=(a=Math.min(a,e.maxImagePosition.maxX),Math.max(n+t.deltaY,e.maxImagePosition.minY));i=Math.min(i,e.maxImagePosition.maxY);e.transform.translate={x:a,y:i},s()}}(e.mc=a).add(new Hammer.Pan({threshold:0,pointers:0})),a.add(new Hammer.Swipe).recognizeWith(a.get("pan")),a.add(new Hammer.Rotate({threshold:0})).recognizeWith(a.get("pan")),a.add(new Hammer.Pinch({threshold:0})).recognizeWith([a.get("pan"),a.get("rotate")]),a.add(new Hammer.Tap({event:"doubletap",taps:2})),a.add(new Hammer.Tap),a.on("panstart panmove",c),a.on("rotatestart rotatemove",function(t){"rotatestart"==t.type&&(h=e.transform.angle||0);i.className="",e.transform.rz=1,e.transform.angle=h+t.rotation,s()}),a.on("pinchstart pinchmove",function(t){"pinchstart"==t.type&&(g=e.transform.scale||1);i.className="",e.transform.scale=g*t.scale,s()}),a.on("hammer.input",function(t){t.isFinal}),e.onPan=c;var g=1;var h=0;transform={translate:{x:r,y:n},scale:1,angle:0,rx:0,ry:0,rz:0},s()};n.draw=function(a,i){var e=this,t=this.getParam();this.cutParmas.x=t.srcX,this.cutParmas.y=t.srcY,this.dealCutParams=function(){var t=e.cutParmas,a={cutBoxHeight:t.cutBoxHeight,cutBoxWidth:t.cutBoxWidth,imgCutHeight:t.imgCutHeight,imgCutWidth:t.imgCutWidth,imgHeight:t.imgHeight,imgUrl:t.imgUrl,imgWidth:t.imgWidth,cutScale:t.cutScale,x:t.x,y:t.y},i=0;return i=0<t.cutBoxWidth/t.cutBoxHeight-t.imgCutWidth/t.imgCutHeight?t.cutBoxWidth/t.imgWidth:t.cutBoxHeight/t.imgHeight,a.cutBoxWidth=t.cutBoxWidth/i,a.cutBoxHeight=t.cutBoxHeight/i,a.x=t.x,a.y=t.y,a};var r=document.createElement("canvas"),n=r.getContext("2d"),m=this.dealCutParams(),o=(a=a||m.imgWidth)/m.cutScale,s=new Image;s.src=this.cutParmas.imgUrl,s.onload=function(){r.width=a,r.height=o,n.drawImage(s,Math.abs(m.x),Math.abs(m.y),m.cutBoxWidth,m.cutBoxHeight,0,0,a,o);var t=r.toDataURL("image/jpeg");i&&i(t)}},t.PGClip=a}(window);