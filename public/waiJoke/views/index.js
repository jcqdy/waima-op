var logStr="";function log(t){}function renderJoke(j,t){function s(t){var e=0,n=0,r=[],o=[];E.font="134px normal fonttt";var i=E.measureText(j).width;if(-1<t.indexOf("A")){for(var s=t.split("A"),a=0;a<s.length;a++)if(s[a]){0<a&&(e+=i,r.push({size:134,start:n,width:i,str:j}),n+=i),E.font="104px normal fonttt";var l=E.measureText(s[a]).width;e+=l,r.push({size:104,start:n,width:l,str:s[a]}),n+=l}}else E.font="104px normal fonttt",e=E.measureText(t).width,r.push({size:104,start:n,width:e,str:t});if(T<e){for(var c=[],u=0,m=0;m<r.length;m++){var f=r[m].str,h=0,g=0,d=0,p=[];if(f==j){for(a=0;a<f.length;a++){E.font="134px normal fonttt";var w=E.measureText(f[a]).width;u+(g+=w)<=T?p.push(f[a]):(c.push({size:134,width:h,start:u,str:p.join("")}),h=u=0,(p=[]).push(f[a])),h+=w,d+=w}c.push({size:134,width:h,start:u,str:p.join("")}),u+=h}else{for(a=0;a<f.length;a++){E.font="98px normal fonttt";var v=E.measureText(f[a]).width;if(u+(g+=v)<=T)p.push(f[a]);else{var y="",x=0;function I(t){if(z(t)){var e=p.pop();E.font="98px normal fonttt";var n=E.measureText(e).width;x+=n,y=e+y,I(e)}}I(f[a]),d-=x,h-=x,c.push({size:98,width:h,start:u,str:p.join("")}),u=0,g=h=x,p=[],y?p=p.concat((y+f[a]).split("")):p.push(f[a])}h+=v,d+=v}c.push({size:98,width:h,start:u,str:p.join("")}),u+=h}u%=T,d}o=c}else{var k=(T-e)/2;for(m=0;m<r.length;m++)o.push({size:r[m].size,start:k,str:r[m].str}),k+=r[m].width}return o}function z(t){return!!/\，|\“|\”|\。|\、|\？|\！|\：|\；|\‘|\’|\《|\》|\/|\~/.test(t)}var a=manJson[parseInt(Math.random()*manJson.length)];t||(a=womanJson[parseInt(Math.random()*womanJson.length)]);var r=document.getElementById("myCanvas"),E=r.getContext("2d"),l=80;var e,n,T=1160,c=1500,o=function(){for(var t=0,e=0;e<a.length;e++){for(var n=s(a[e]),r=!1,o=!1,i=0;i<n.length;i++)134==n[i].size?r=!0:98==n[i].size&&(o=!0);for(t+=r?180:o?150:165,i=0;i<n.length;i++)0<i&&0==n[i].start&&(t+=140)}return t}()+1e3;r.width=c,r.height=o,E.fillStyle="rgba(255, 255, 255, 0)",E.fillRect(0,0,c,o),e=function(){!function(){for(var t=0;t<a.length;t++){for(var e=s(a[t]),n=!1,r=!1,o=0;o<e.length;o++)134==e[o].size?n=!0:98==e[o].size&&(r=!0);l+=n?180:r?150:165;var i=(c-T)/2;for(o=0;o<e.length;o++)0<o&&0==e[o].start&&(l+=140),E.fillStyle="black",E.font=e[o].size+"px normal fonttt",E.fillText(e[o].str,e[o].start+i,l)}}();var t=new Image;t.setAttribute("crossOrigin","Anonymous"),t.src="./../resource/images/scan_tips.png",t.onload=function(){E.drawImage(t,(c-688)/2,o-640,688,84);var n=new Image;n.setAttribute("crossOrigin","Anonymous"),n.src="./../resource/images/qrocde.jpg",n.onload=function(){E.drawImage(n,(c-400)/2,o-480,400,400);var t=document.getElementById("joke-wrapper"),e=document.getElementById("joke-pic");e.src=r.toDataURL("image/png"),setTimeout(function(){e.style.height=e.width*o/c+"px",t.style.width=e.width,t.style.height=e.width*o/c+"px"})}}},(n=new Image).setAttribute("crossOrigin","Anonymous"),n.src="./../resource/images/bg_repeat.jpg",n.onload=function(){for(var t=0;t<Math.ceil(o/408);t++)E.drawImage(n,0,408*t,1500,408);e&&e()}}function initRouter(t){function e(t){String.prototype.filterUrl=function(){return this.replace(/#\//,"")},this.config=t,this.init=function(){var t=this;t._init(),window.addEventListener("hashchange",function(){t._init()})}}e.prototype={_init:function(){for(var t=location.hash.filterUrl().split("/"),e=document.getElementsByClassName("page"),n=0;n<e.length;n++)e[n].style.display="none";document.getElementById(t[0]||"home").style.display="block"}};new e([{url:"",templateId:"home"},{url:"joke",templateId:"joke"}]).init(),t&&t()}initRouter(function(){var t=document.getElementById("man"),e=document.getElementById("woman"),n=document.getElementById("confirm"),r=document.getElementById("name"),o=1;t.addEventListener("click",function(){t.src="./../resource/images/man_checked.jpg",e.src="./../resource/images/woman.jpg",o=1},!1),e.addEventListener("click",function(){t.src="./../resource/images/man.jpg",e.src="./../resource/images/woman_checked.jpg",o=0},!1),n.addEventListener("click",function(){var t=r.value;t&&(renderJoke(t,o),utils.goTo("joke"))},!1)}),utils.getSig(location.href.split("#")[0]),wx.ready(function(){var t=location.href.split("#")[0],e="http://op.ekaogo.com/beautiful/resource/images/share.jpeg";wx.onMenuShareTimeline({title:"歪段子\n你咋这么搞笑呢",link:t,imgUrl:e,success:function(){},cancel:function(){}}),wx.onMenuShareAppMessage({title:"歪段子",desc:"你咋这么搞笑呢",link:t,imgUrl:e,type:"",dataUrl:"",success:function(){},cancel:function(){}})}),wx.error(function(t){console.log(t)});